#### 1.常见单例模式

```
一个类只有一个实例，并提供该实例的全局访问点。
```

- ##### 饿汉式
```java
public class Singleton {
    private static final Singleton INSTANCE = new Singleton();
    /**
     * 构造函数私有
     */
    private Singleton(){}

    public static Singleton getInstance(){
        return INSTANCE;
    }
}
```

- ##### 懒汉式
```java
public class Singleton {
    private static volatile Singleton instance;

    /**
     * 构造函数私有
     */
    private Singleton() {}

    public static synchronized Singleton getInstance() {
        if (instance == null) {
            instance = new Singleton();
        }
        return instance;
    }
}
```

- ##### 双重检查
```java
public class Singleton {
    private static volatile Singleton instance;
    /**
     * 构造函数私有
     */
    private Singleton(){}

    public static Singleton getInstance(){
        if(instance == null){
            synchronized (Singleton.class){
                if(instance == null){
                    instance = new Singleton();
                }
            }
        }
        return instance;
    }
}
```

- ##### 静态内部类
```java
public class Singleton {
    private static Singleton instance;
    /**
     * 构造函数私有
     */
    private Singleton(){}

    private static class InstanceHolder{
        private static final Singleton instance = new Singleton();
    }

    public static Singleton getInstance(){
        return InstanceHolder.instance;
    }
}
```

- ##### 枚举
```java
public enum Singleton {
    INSTANCE;
}
```
---

#### 2.单例模式漏洞

```
单例模式可通过反射和序列化、反序列化方式破解
```

```java
public class Singleton implements Serializable {
    private static volatile Singleton instance;

    private Singleton() {
        //规避反射造成的单例被破坏
        if (instance != null) {
            throw new RuntimeException("");
        }
    }

    public static Singleton getInstance() {
        if (instance == null) {
            synchronized (Singleton.class) {
                if (instance == null) {
                    instance = new Singleton();
                }
            }
        }
        return instance;
    }

    /**
     * 规避序列化和反序列化造成的单例被破坏
     * @return
     * @throws ObjectStreamException
     */
    private Object readResolve() throws ObjectStreamException {
        return instance;
    }
}
```


